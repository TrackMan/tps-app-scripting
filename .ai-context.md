# AI Assistant Context File

> **Purpose**: This file | Working On | Read This |
|------------|-----------|
| Event handling | [ACTIVITY_SESSION_STATE.md](./docs/technical/ACTIVITY_SESSION_STATE.md) |
| Measurement display | [MEASUREMENT_TILES_MULTI_EVENT.md](./docs/technical/MEASUREMENT_TILES_MULTI_EVENT.md) |
| Hole/shot tracking | [SHOT_NUMBER_CARRY_FORWARD_FIX.md](./docs/technical/SHOT_NUMBER_CARRY_FORWARD_FIX.md) |
| Course info & images | [HOLE_IMAGE_DISPLAY.md](./docs/technical/HOLE_IMAGE_DISPLAY.md) |
| Shot trajectory overlay | [SHOT_TRAJECTORY_VISUALIZATION.md](./docs/technical/SHOT_TRAJECTORY_VISUALIZATION.md) |
| Unit conversion | [UNIT_CONVERSION_SYSTEM.md](./docs/technical/UNIT_CONVERSION_SYSTEM.md) |
| Filtering events | [DEVICE_ID_FILTERING.md](./docs/technical/DEVICE_ID_FILTERING.md) |
| Local development | [WEBHOOK_LOCAL_FIX.md](./docs/technical/WEBHOOK_LOCAL_FIX.md) |
| Azure Storage | [LOCAL_AZURE_STORAGE_SETUP.md](./docs/technical/LOCAL_AZURE_STORAGE_SETUP.md) |ssistants understand the project structure and where to find documentation.

## üìÇ Project Structure

### User-Facing Documentation
- **Location**: `docs/` (user guides, authoring guides, etc.)
- **Purpose**: Help users create and use app scripts
- **Files**: authoring-guide.md, user-guide.md, schema-reference.md, etc.

### Technical Documentation
- **Location**: `docs/technical/` ‚≠ê **START HERE**
- **Purpose**: Implementation details, bug fixes, feature documentation
- **Index**: [`docs/technical/README.md`](./docs/technical/README.md)
- **When to check**: Before making ANY code changes

### Application Code
- **Frontend**: `src/` - React/TypeScript application
  - `src/components/` - React components
  - `src/hooks/` - Custom React hooks
  - `src/graphql/` - GraphQL queries
  - `src/utils/` - Utility functions

- **Backend**: `server/` - Node.js Express server
  - `server/src/index.ts` - Main server entry
  - `server/src/events.ts` - Event type definitions
  - `server/.env` - Environment variables (not in repo)

- **Schema**: `schema/` - JSON schemas for app scripting
- **Examples**: `examples/` - Example script files

## üéØ Quick Rules for AI Assistants

### Before Making Changes
1. **ALWAYS** check [`docs/technical/README.md`](./docs/technical/README.md) first
2. Look for related documentation about the feature/component you're changing
3. Understand the event ordering (newest at index 0)
4. Consider both initial load AND SSE update paths

### UI/UX Preferences
- **NO EMOJIS**: User preference - avoid using emojis in the UI
- Keep interfaces clean and professional
- Use icons from icon libraries if visual indicators are needed

### When Creating New Features
1. Implement the feature
2. Create documentation in `docs/technical/FEATURE_NAME.md`
3. Update [`docs/technical/README.md`](./docs/technical/README.md) to include your new doc
4. Use the template structure provided in the README

### When Fixing Bugs
1. Check if a fix already exists in `docs/technical/`
2. Implement the fix
3. Document it in `docs/technical/FIX_DESCRIPTION.md`
4. Update the index

## üìö Key Documentation Files

Must-read before working on these areas:

| Working On | Read This |
|------------|-----------|
| Event handling | [ACTIVITY_SESSION_STATE.md](./docs/technical/ACTIVITY_SESSION_STATE.md) |
| Measurement display | [MEASUREMENT_TILES_MULTI_EVENT.md](./docs/technical/MEASUREMENT_TILES_MULTI_EVENT.md) |
| Hole/shot tracking | [SHOT_NUMBER_CARRY_FORWARD_FIX.md](./docs/technical/SHOT_NUMBER_CARRY_FORWARD_FIX.md) |
| Course info & images | [HOLE_IMAGE_DISPLAY.md](./docs/technical/HOLE_IMAGE_DISPLAY.md) |
| Unit conversion | [UNIT_CONVERSION_SYSTEM.md](./docs/technical/UNIT_CONVERSION_SYSTEM.md) |
| Filtering events | [DEVICE_ID_FILTERING.md](./docs/technical/DEVICE_ID_FILTERING.md) |
| Local development | [WEBHOOK_LOCAL_FIX.md](./docs/technical/WEBHOOK_LOCAL_FIX.md) |
| Azure Storage | [LOCAL_AZURE_STORAGE_SETUP.md](./docs/technical/LOCAL_AZURE_STORAGE_SETUP.md) |

## üîç Common Patterns

### Event List Structure
```typescript
// Events are ordered: newest at index 0
const events = [
  { id: '3', timestamp: '14:08:00' }, // ‚Üê Newest (index 0)
  { id: '2', timestamp: '14:07:55' },
  { id: '1', timestamp: '14:07:50' }  // ‚Üê Oldest
];

// To search backward in time = search forward through array
for (let i = currentIndex + 1; i < events.length; i++) {
  const olderEvent = events[i]; // Going back in time
}
```

### Session Matching
```typescript
// Always check ActivitySession.Id when correlating events
const { activitySessionId } = getSessionIds(event);
if (prevSessionId === activitySessionId) {
  // Events belong to same session
}
```

### Data Extraction
```typescript
// Events have nested structures
const payload = event?.data?.EventModel || event?.EventModel || event;
```

## üö´ Common Mistakes to Avoid

1. **Don't assume event order** - Newest is at index 0, not at the end
2. **Don't store transient data in session state** - Only store truly shared data (like course info)
3. **Don't forget SSE updates** - Changes must work for both initial load AND real-time updates
4. **Don't skip documentation** - Always document significant changes
5. **Don't create root-level .md files** - Put technical docs in `docs/technical/`

## üíæ Key State Management

### Session State (useRef)
- **Location**: `src/hooks/useActivitySessionState.ts`
- **Purpose**: Store course info shared across events in same ActivitySession
- **Storage**: `useRef<Map<string, ActivitySessionData>>`
- **Why useRef**: Prevents re-renders, persists across component lifecycle

### Local Storage
- **Unit preferences**: `measurementUnitSystem` ('imperial' | 'metric')
- **Persists across**: Page refreshes, browser sessions

### URL Parameters
- **Device filtering**: `?deviceId=abc123`
- **Bay filtering**: `?bayId=bay-1`

## üîß Development Commands

```bash
# Install dependencies
npm install

# Start frontend dev server (port 5000)
npm run dev

# Start backend server (port 4000)
cd server && npm start

# Run both with watch mode
npm run start-dev

# Validate example scripts
npm run validate

# Format code
npm run format
```

## üìù File Naming Conventions

### Technical Documentation
- **Features**: `FEATURE_NAME.md` (e.g., `DEVICE_ID_FILTERING.md`)
- **Fixes**: `FIX_DESCRIPTION.md` (e.g., `SHOT_NUMBER_CARRY_FORWARD_FIX.md`)
- **Setup**: `SETUP_DESCRIPTION.md` (e.g., `LOCAL_AZURE_STORAGE_SETUP.md`)
- **All CAPS with underscores**: Easier to spot in file listings

### Code Files
- **Components**: PascalCase (e.g., `WebhookInspector.tsx`)
- **Hooks**: camelCase with 'use' prefix (e.g., `useActivitySessionState.ts`)
- **Utils**: camelCase (e.g., `sessionHelpers.ts`)

## üéØ Remember

**The `docs/technical/` folder is your AI context repository.**

When a user says:
- "Why does X work this way?" ‚Üí Check docs/technical/
- "Can you implement Y?" ‚Üí Check if Y is documented first
- "This is broken!" ‚Üí Check if there's a fix doc
- "How does Z work?" ‚Üí Point them to the relevant doc

**Always update documentation when you make significant changes!**

---

**Last Updated**: October 3, 2025
