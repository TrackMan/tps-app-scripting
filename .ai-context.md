# AI Assistant Context File

> **Purpose**: This file helps AI assistants understand the project structure and where to find documentation.

## ️ CRITICAL RULE: Documentation File Placement

###  NEVER create `.md` files in these locations:
-  **Root directory** (except readme.md, NEXT_STEPS.md, DOCUMENTATION_README.md)
-  **src/** or any subdirectories
-  **src/components/** or component folders
-  **server/** (except server/README.md which already exists)
-  **Any code directory**

###  ALWAYS create technical documentation here:
-  **`docs/technical/`** - All implementation docs, bug fixes, feature docs
-  **`docs/`** - Only user-facing guides (authoring, user guides, etc.)

###  When You Create Documentation:
1. **Check**: Is this technical/implementation documentation?
   -  YES → Create in `docs/technical/FEATURE_NAME.md`
   -  NO → Is it a user guide? Create in `docs/USER_GUIDE_NAME.md`

2. **Update the index**: Add your new file to `docs/technical/README.md`

3. **Use proper naming**: 
   - Technical docs: `FEATURE_NAME.md` or `FIX_DESCRIPTION.md` (ALL_CAPS)
   - User docs: `kebab-case.md` (lowercase-with-hyphens)

###  If User Says "You Created .md Files in Wrong Place":
This means you violated this rule. Immediately:
1. Apologize
2. Move ALL misplaced `.md` files to `docs/technical/`
3. Update `docs/technical/README.md` to include them
4. Delete the misplaced files
5. Verify no orphaned `.md` files remain in code directories

---

##  Project Structure

### User-Facing Documentation
- **Location**: `docs/` (user guides, authoring guides, etc.)
- **Purpose**: Help users create and use app scripts
- **Files**: authoring-guide.md, user-guide.md, schema-reference.md, etc.

### Technical Documentation
- **Location**: `docs/technical/` ⭐ **START HERE**
- **Purpose**: Implementation details, bug fixes, feature documentation
- **Index**: [`docs/technical/README.md`](./docs/technical/README.md)
- **When to check**: Before making ANY code changes

### Application Code
- **Frontend**: `src/` - React/TypeScript application
  - `src/components/` - React components
  - `src/hooks/` - Custom React hooks
  - `src/graphql/` - GraphQL queries
  - `src/utils/` - Utility functions

- **Backend**: `server/` - Node.js Express server
  - `server/src/index.ts` - Main server entry
  - `server/src/events.ts` - Event type definitions
  - `server/.env` - Environment variables (not in repo)

- **Schema**: `schema/` - JSON schemas for app scripting
- **Examples**: `examples/` - Example script files

##  Quick Rules for AI Assistants

### Before Making Changes
1. **ALWAYS** check [`docs/technical/README.md`](./docs/technical/README.md) first
2. Look for related documentation about the feature/component you're changing
3. Understand the event ordering (newest at index 0)
4. Consider both initial load AND SSE update paths

### UI/UX Preferences
- **NO EMOJIS**: User preference - avoid using emojis in the UI
- Keep interfaces clean and professional
- Use icons from icon libraries if visual indicators are needed

### When Creating New Features
1. Implement the feature
2. **ALWAYS** create documentation in `docs/technical/FEATURE_NAME.md` (**NOT in root or src/**)
3. Update [`docs/technical/README.md`](./docs/technical/README.md) to include your new doc
4. Use the template structure provided in the README

### When Fixing Bugs
1. Check if a fix already exists in `docs/technical/`
2. Implement the fix
3. **ALWAYS** document it in `docs/technical/FIX_DESCRIPTION.md` (**NOT in root or src/**)
4. Update the index in `docs/technical/README.md`

### When Adding Deployment/Infrastructure Changes
1. Implement the changes
2. **ALWAYS** document in `docs/technical/DEPLOYMENT_*.md` or `docs/technical/AZURE_*.md`
3. Never create `DEPLOYMENT_FIX.md` or `AZURE_*.md` in root directory
4. Update `docs/technical/README.md` index

##  Key Documentation Files

Must-read before working on these areas:

| Working On | Read This |
|------------|-----------|
| Event handling | [ACTIVITY_SESSION_STATE.md](./docs/technical/ACTIVITY_SESSION_STATE.md) |
| Measurement display | [MEASUREMENT_TILES_MULTI_EVENT.md](./docs/technical/MEASUREMENT_TILES_MULTI_EVENT.md) |
| Hole/shot tracking | [SHOT_NUMBER_CARRY_FORWARD_FIX.md](./docs/technical/SHOT_NUMBER_CARRY_FORWARD_FIX.md) |
| Course info & images | [HOLE_IMAGE_DISPLAY.md](./docs/technical/HOLE_IMAGE_DISPLAY.md) |
| Unit conversion | [UNIT_CONVERSION_SYSTEM.md](./docs/technical/UNIT_CONVERSION_SYSTEM.md) |
| Filtering events | [DEVICE_ID_FILTERING.md](./docs/technical/DEVICE_ID_FILTERING.md) |
| Local development | [WEBHOOK_LOCAL_FIX.md](./docs/technical/WEBHOOK_LOCAL_FIX.md) |
| Azure Storage | [LOCAL_AZURE_STORAGE_SETUP.md](./docs/technical/LOCAL_AZURE_STORAGE_SETUP.md) |

##  Common Patterns

### Event List Structure
```typescript
// Events are ordered: newest at index 0
const events = [
  { id: '3', timestamp: '14:08:00' }, // ← Newest (index 0)
  { id: '2', timestamp: '14:07:55' },
  { id: '1', timestamp: '14:07:50' }  // ← Oldest
];

// To search backward in time = search forward through array
for (let i = currentIndex + 1; i < events.length; i++) {
  const olderEvent = events[i]; // Going back in time
}
```

### Session Matching
```typescript
// Always check ActivitySession.Id when correlating events
const { activitySessionId } = getSessionIds(event);
if (prevSessionId === activitySessionId) {
  // Events belong to same session
}
```

### Data Extraction
```typescript
// Events have nested structures
const payload = event?.data?.EventModel || event?.EventModel || event;
```

##  Common Mistakes to Avoid

1. **Don't assume event order** - Newest is at index 0, not at the end
2. **Don't store transient data in session state** - Only store truly shared data (like course info)
3. **Don't forget SSE updates** - Changes must work for both initial load AND real-time updates
4. **Don't skip documentation** - Always document significant changes in `docs/technical/`
5. ** NEVER create .md files in root or src/** - Use `docs/technical/` instead
6. ** NEVER create component READMEs** - Move to `docs/technical/COMPONENT_NAME.md`
7. **Don't forget to update** `docs/technical/README.md` when adding new docs

##  Key State Management

### Session State (useRef)
- **Location**: `src/hooks/useActivitySessionState.ts`
- **Purpose**: Store course info shared across events in same ActivitySession
- **Storage**: `useRef<Map<string, ActivitySessionData>>`
- **Why useRef**: Prevents re-renders, persists across component lifecycle

### Local Storage
- **Unit preferences**: `measurementUnitSystem` ('imperial' | 'metric')
- **Persists across**: Page refreshes, browser sessions

### URL Parameters
- **Device filtering**: `?deviceId=abc123`
- **Bay filtering**: `?bayId=bay-1`

##  Development Commands

```bash
# Install dependencies
npm install

# Start frontend dev server (port 5000)
npm run dev

# Start backend server (port 4000)
cd server && npm start

# Run both with watch mode
npm run start-dev

# Validate example scripts
npm run validate

# Format code
npm run format
```

##  File Naming Conventions

### Technical Documentation
- **Features**: `FEATURE_NAME.md` (e.g., `DEVICE_ID_FILTERING.md`)
- **Fixes**: `FIX_DESCRIPTION.md` (e.g., `SHOT_NUMBER_CARRY_FORWARD_FIX.md`)
- **Setup**: `SETUP_DESCRIPTION.md` (e.g., `LOCAL_AZURE_STORAGE_SETUP.md`)
- **All CAPS with underscores**: Easier to spot in file listings

### Code Files
- **Components**: PascalCase (e.g., `WebhookInspector.tsx`)
- **Hooks**: camelCase with 'use' prefix (e.g., `useActivitySessionState.ts`)
- **Utils**: camelCase (e.g., `sessionHelpers.ts`)

##  Remember

**The `docs/technical/` folder is your AI context repository.**

When a user says:
- "Why does X work this way?" → Check docs/technical/
- "Can you implement Y?" → Check if Y is documented first
- "This is broken!" → Check if there's a fix doc
- "How does Z work?" → Point them to the relevant doc

**Always update documentation when you make significant changes!**

---

**Last Updated**: October 3, 2025
